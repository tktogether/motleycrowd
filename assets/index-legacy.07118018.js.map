{"version":3,"file":"index-legacy.07118018.js","sources":["../../../../../../../@vite/dynamic-import-helper","../../src/system.js","../../src/index.js"],"sourcesContent":["export default (glob, path) => {\n    const v = glob[path];\n    if (v) {\n        return typeof v === 'function' ? v() : Promise.resolve(v);\n    }\n    return new Promise((_, reject) => {\n        (typeof queueMicrotask === 'function' ? queueMicrotask : setTimeout)(reject.bind(null, new Error('Unknown variable dynamic import: ' + path)));\n    });\n}","async function initGlobal() {\n    window.$ = {};\n    window.$.utils =\n    window.$u =\n    window.$utils = await import('./functions/index.js');\n    window.$.logic =\n    window.$logic = await import('./functions/logic.js');\n    window.$.normalize =\n    window.$norml =\n    window.$normalize = await import('./functions/normalize.js');\n    window.$.hash =\n    window.$hash = await import('./functions/hash.js');\n\n    window.$.event =\n    window.$event = await import('./event/index.js');\n    window.$on = $event.on;\n    window.$off = $event.off;\n    window.$emit = $event.emit;\n\n    window.$.moment =\n    window.$moment = (await import('moment')).default;\n}\n\nasync function configure(mods, lists) {\n    const configure = {};\n    for (const mod of mods) {\n        configure[mod] = {};\n    }\n    await Promise\n        .all(lists.map(p=>import(`./config/${p}.js`).catch(_=>null)))\n        .then(modules=>modules.forEach(m => {\n            if(!m) return;\n            for (const mod of mods) {\n                if(!m[mod]) continue;\n                Object.assign(configure[mod], m[mod]());\n            }\n        }));\n    return configure;\n}\n\nasync function initDebug(configure) {\n    if(!configure) return;\n    window.$.debug =\n    window.$debug = configure.on;\n    if($debug && configure.patch) {\n        await configure.patch();\n    }\n}\n\nasync function initLogger(configure) {\n}\n\nasync function initLang(configure) {\n    const {default: Lang} = await import('./i18n/index.js');\n    const lang = new Lang(configure);\n    window.$.lang =\n    window.$lang = lang;\n    await lang.initialize();\n}\n\nasync function initCore(configure) {\n    const {default: Core} = await import('./core/index.js');\n    const core = new Core(configure);\n    window.$.core =\n    window.$$ =\n    window.$core = core;\n    await core.initialize();\n}\n\nasync function initApp(configure) {\n    const {default: App} = await import('./app/index.js');\n    const app = new App(configure);\n    window.$.app =\n    window.$app = app;\n    await app.initialize();\n}\n\nfunction dURL() {\n    const match = /\\/#\\/(([^\\/\\?]+)\\/?)(\\?+(.*))?/\n        .exec(window.location.href);\n    if(!match) return;\n    let [,,page,,data,,query] = match;\n    if(!data) data = {};\n    else data = JSON.parse(decodeURIComponent(data));\n    if(query)\n        query.split('&').forEach(v=>{\n            const [key, value] = v.split('=');\n            data[key] = JSON.parse(decodeURIComponent(value))\n        });\n    $app.switch(page, data);\n}\n\nexport async function start(cfgList) {\n    window.onerror = (msg,source,line,col,error) =>\n        alert(`${msg}at: ${source||\"<anonymous>\"}:${line}:${col}\\n${error}`);\n\n    await initGlobal();\n\n    $on('network.banned', ()=>window.location.reload());\n\n    const { debug, logger, i18n, core, app } = await configure(\n        ['debug', 'logger', 'i18n', 'core', 'app'], cfgList\n    );\n\n    await initDebug(debug);\n    await initLogger(logger);\n    await initLang(i18n);\n    await initCore(core);\n    await initApp(app);\n\n    $app.loading = true;\n    try {\n        const banned = $core.database.kv.get('banned');\n        if(banned && banned > Date.now()) {\n            $app.tips($lang.t.banned);\n            return;\n        }\n        await $core.start();\n        await $app.start();\n        $app.loading = false;\n        $emit('system.start');\n    } catch(e) {\n        console.error(e);\n        $app.tips($lang.t.init_err);\n    }\n    window.onpopstate = dURL;\n    dURL();\n}\n\nexport default start;","import { start } from './system.js';\n\nstart([\n    'configure.default',\n    'configure.search',\n    'configure',\n]);"],"names":["__variableDynamicImportRuntimeHelper","exports","glob","path","v","Promise","resolve","_","reject","queueMicrotask","setTimeout","bind","Error","initGlobal","_initGlobal","apply","this","arguments","_asyncToGenerator","_regeneratorRuntime","mark","window","$","_context","__vitePreload","module","import","utils","$u","$utils","logic","$logic","sent","next","normalize","$norml","$normalize","__VITE_IS_MODERN__","hash","$hash","event","$event","$on","on","$off","off","$emit","emit","moment","$moment","default","stop","_callee","configure","_x","_x2","_configure","initDebug","mods","lists","_iterator4","_createForOfIteratorHelper","s","_step4","n","done","mod","all","map","p","Object","assign","catch","then","modules","forEach","m","_step5","_iterator5","value","err","e","f","_context2","abrupt","_callee2","debug","$debug","patch","_context3","_callee3","_initDebug","_x4","_initLogger","initLang","_callee4","wrap","_context4","prev","_x5","_initLang","_callee5","_yield$__vitePreload","Lang","lang","_context5","$lang","initialize","initCore","_x6","_initCore","initApp","core","_yield$__vitePreload2","_context6","Core","$$","$core","_callee6","_x7","_initApp","_callee7","_yield$__vitePreload3","App","app","_context7","$app","dURL","match","exec","location","href","_match","_slicedToArray","page","data","query","JSON","parse","decodeURIComponent","split","key","switch","start","cfgList","onerror","msg","source","line","col","error","alert","_context8","reload","logger","i18n","_yield$configure","initLogger","loading","banned","database","kv","get","Date","now","tips","t","console","t0","init_err","onpopstate"],"mappings":"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"}